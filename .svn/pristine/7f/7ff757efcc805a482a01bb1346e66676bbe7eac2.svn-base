/**
 * Created by wangjin on 2016/3/9.
 */

    $(document).ready(function() {

        $("<div id=\"ajaxReturnTips\"></div>").css({ "position": "absolute", "left": "50%", "top": "50%", "text-align": "center", "margin-left": "-100px", "margin-top": "-25px", "width": "200px", "height": "50px", "line-height": "50px", "background-color": "#F0F9F9", "opacity": "0.8", "display": "none", "z-index": "90009" }).prependTo("body");

        //注册页面当获取焦点的时候
        $(".user_table input").focus(function() {
            var idname = $(this).attr("id");
            var content = $(this).parents("tr").find(".content");
            var icontips = $(this).parents("tr").find(".icontips");
            icontips.removeClass("icontips1 icontips2 icontips3 icontips4").addClass("icontips1");
            if(idname=="getverify") { //如果是获取验证码
                icontips.removeClass("icontips1 icontips2 icontips3 icontips4");
                content.html("");
                return false;
            }
            switch(idname) {
                case "news_title":
                    content.html("文章标题不得超过30个字!");
                    break;
                case "nickname":
                    content.html("2~6个汉字，中文名字!");
                    break;
                case "qqcard":
                    content.html("2~12个数字，QQ号!");
                    break;
                case "weixin":
                    content.html("6~20个字母、数字、下划线和减号，必须以字母开头!");
                    break;
                case "email":
                    content.html("QQ邮箱,163邮箱等!");
                    break;
                case "birthday":
                    content.html("选择您的生日日期!");
                    break;
                case "telephone":
                    content.html("请输入您的电话号码!");
                    break;
                case "dxverify":
                    content.html("短信验证码!");
                    break;
                case "address":
                    content.html("请输入常用联系地址,50个字以内!");
                    break;
                case "company":
                    content.html("请输入您的公司名称,30个字以内!");
                    break;
                case "telephones":
                    content.html("请输入您的电话号码,多个以','隔开!");
                    break;
            }
        }).blur(function() {
            var errortext = '';
            var idname = $(this).attr("id");
            var value = trim($(this).val());
            var content = $(this).parents("tr").find(".content");
            var icontips = $(this).parents("tr").find(".icontips");
            if(idname=="getverify") { //如果是获取验证码
                icontips.removeClass("icontips1 icontips2 icontips3 icontips4");
                content.html("");
                return false;
            }
            //先判断是否为空
            if(!value) {
                icontips.removeClass("icontips1 icontips2 icontips3 icontips4").addClass("icontips2");
                content.html("内容不能为空!");
                return false;
            }
            switch(idname) {
                case "news_title":
                    if(!check_newstitle(value)) errortext = "文章标题格式不正确!";
                    break;
                case "nickname":
                    if(!check_nickname(value)) errortext = "姓名格式不正确!";
                    break;
                case "qqcard":
                    if(!check_qqcard(value)) errortext = "QQ号格式不正确!";
                    break;
                case "weixin":
                    if(!check_weixincard(value)) errortext = "微信号格式不正确!";
                    break;
                case "email":
                    if(!check_email(value)) errortext = "邮箱格式不正确!";
                    break;
                case "birthday":
                    if(!check_birthday(value)) errortext = "生日日期格式不正确!";
                    break;
                case "telephone":
                    if(!check_telephone(value)) errortext = "电话号码格式不正确!";
                    break;
                case "dxverify":
                    if(!check_dxverify(value)) errortext = "短信验证码格式不正确!";
                    break;
            }
            if(errortext == '') {
                icontips.removeClass("icontips1 icontips2 icontips3 icontips4").addClass("icontips3");
                content.html("");
            } else {
                icontips.removeClass("icontips1 icontips2 icontips3 icontips4").addClass("icontips2");
                content.html(errortext);
            }
        });

        //接触按钮的点击绑定
        $(".action_btn").unbind("click");

        /**
         * 对点击action执行操作，弹出层或者其他的
         */
        $(".action_btn").click(function() {
            actionName = $(this).find("a").attr("id");
            var hrefUrl = $(this).find("a").attr("href");
            var aText =  $(this).find("a").text();
            switch(actionName) {
                case 'edit': //获取当前选中的数据对象，循环写入到对应input的value中，弹出层
                    var count = 0;
                    var tr_key;
                    for(var key in checkboxObj) {
                        count++;
                        tr_key = key;
                    }
                    if(count>1) {
                        alert("只能选择一条数据进行修改!");
                        break;
                    } else if(count==0) {
                        alert("请选择一条数据进行修改!");
                        break;
                    }
                    window.location.href = hrefUrl+"?id="+checkboxObj[tr_key]["win_id"];
                    break;
                case 'add':
                case 'sendmore':
                case 'changetel':
                case 'showaddlist':
                case 'changeaddlist':
                    window.location.href = hrefUrl;
                    break;
            }
            return false;
        });

        //表单提交
        $(".huiyuan_form").submit(function() {

            $.ajax({
                type: 'POST',
                url: $(this).attr("action"),
                data: $(this).serialize(),
                dataType:'json',
                beforeSend:function() {
                    $("<div id=\"ajaxLoadingTips\"></div>").css({ "position": "absolute", "left": "50%", "top": "50%", "margin-left": "-50px", "margin-top": "-12px", "width": "100px", "height": "25px", "background-color": "#dce9f9", "opacity": "0.8", "display": "block", "padding-top": "7px", "padding-left": "20px", "z-index": "90009" }).prependTo("body").append("<div class='loading'>正在提交...</div>");
                },
                success:function(result) {
                    $("#ajaxLoadingTips").remove();
                    if(result.ret == 0) {
                        showtips('数据提交成功', "green", 2, $("#ajaxReturnTips"));
                        setTimeout(function() {history.go(-1);}, 2000);
                    } else {
                        showtips(result.msg, "red", 2, $("#ajaxReturnTips"));
                    }
                },
                complete:function() {

                },
                error:function() {
                    showtips('数据加载失败', "red", 2, $("#ajaxReturnTips"));
                }
            });
            return false; //防止表单再次提交
        });

        //全选
        $("#checkall").click(function() {
            var usersli = $(this).parents(".usersdiv").find("ul input");
            if($(this).attr("checked") != true) {
                for(var i=0; i<usersli.length; i++) {
                    if($(usersli[i]).attr("checked") != true) {
                        $(usersli[i]).attr("checked", "true");
                    }
                }
            }
            if($(this).attr("checked") == null) {
                for(var i=0; i<usersli.length; i++) {
                    if($(usersli[i]).attr("checked") != true) {
                        $(usersli[i]).removeAttr("checked");
                    }
                }
            }
        });

        //去掉全选
        $(".usersli input:checkbox").click(function() {
            if($(this).attr("checked") != true) {
                $("#checkall").attr("checked", false);
            }
        });
    });